//===----------------------------------------------------------------------===//
//
// Part of libcu++, the C++ Standard Library for your entire system,
// under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
//===----------------------------------------------------------------------===//

#ifndef _LIBCUDAFORDALICXX_CUDA_UTIL
#define _LIBCUDAFORDALICXX_CUDA_UTIL

#include "cuda/std/detail/__config"
#include "cuda/std/detail/__pragma_push"

#include <iosfwd>  // for string forward decl

#include <cuda_for_dali/exception>

#ifdef _LIBCUDAFORDALICXX_NO_EXCEPTIONS
#include <cstdlib>
#endif
#include "cuda/std/detail/__pragma_push"

#include <cuda_runtime_api.h>

_LIBCUDAFORDALICXX_BEGIN_NAMESPACE_CUDA

namespace detail {
inline _LIBCUDAFORDALICXX_INLINE_VISIBILITY
void __throw_on_cuda_error(::cudaError_t __error, char const *__msg) {
  if (::cudaSuccess != __error) {
    ::cudaGetLastError(); // Clear CUDA error state
#ifndef _LIBCUDAFORDALICXX_NO_EXCEPTIONS
    throw cuda_for_dali::cuda_error{__error, __msg};
#else
    ::std::abort();
#endif
  }
}

inline _LIBCUDAFORDALICXX_INLINE_VISIBILITY
void __throw_on_cuda_error(::cudaError_t __error) {
  __throw_on_cuda_error(__error, "");
}

} // namespace detail

_LIBCUDAFORDALICXX_END_NAMESPACE_CUDA

#include "../std/detail/__pragma_pop"

#endif // _LIBCUDAFORDALICXX_CUDA_UTIL
